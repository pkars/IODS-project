# Week 2: Regression and model validation
This section is the report for the second week of IODS. To start with, here are the instructions given for writing this report:

>*Describe the work you have done this week and summarize your learning.*
>
>- Describe your work and results clearly. 
>- Assume the reader has an introductory course level understanding of writing and reading R code as well as statistical methods.
>- Assume the reader has no previous knowledge of your data or the more advanced methods you are using.

With that out of the way, let's start the analysis part of the current exercise set!

## Setting up
First, I need to include a couple of libraries to properly build (or rather, "knit") this report. 

```{r 'setup', message=FALSE}
# knitr is used to build this report, so it is included by default

# Remove the '##' from each line of R output blocks
knitr::opts_chunk$set(comment = '')

# Libraries for convenience
library(dplyr)
library(ggplot2)
library(GGally)
library(gridExtra)

# NOTE: Messages are omitted
```

## The analysis data
The analysis data was produced in "Data wrangling" part of the exercises. The original data is the "JYTOPKYS2" study data by Kimmo Vehkalahti. The original data is available from [here](https://www.mv.helsinki.fi/home/kvehkala/JYTmooc/JYTOPKYS3-data.txt) and the data is explained [here](https://www.mv.helsinki.fi/home/kvehkala/JYTmooc/JYTOPKYS2-meta.txt).

The analysis data is a mix of original variables (`gender`, `age`, `attitude`, and `points`) and derived variables (`deep`, `stra`, and `surf`). The original and derived variables are explained as following, based on Vehkalahti's metadata. Note that the derived variables were omitted from the original data linked above -- so that we'd have to calculate them ourselves -- but they were included in the metadata.

| Variable | Meaning | Type | Notes |
|--|--------|--|--------|
| `gender`| Gender of the student | Categorical | "M" or "F" |
| `age` | Age (in years) | Number | derived from the date of birth |
| `attitude` | Global attitude toward statistics | Number | Sum of 10 answers |
| `points` | Total points from coursework | Number | Student's best exam score + extra points from answering the study questionnaire  |
| `deep` | Average score of answers related to Deep approach | Number | Avg. of 12 answers |
| `stra` | Average score of answers related to Strategic approach | Number | Avg. of 12 answers |
| `surf` | Average score of answers related to Surface approach | Number| Avg. of 8 answers |

You can see the creation script [here](https://github.com/pkars/IODS-project/blob/master/data/create_learning2014.R) (most recent version) or the original from [commit `bb6de84`](https://github.com/pkars/IODS-project/blob/bb6de848b26bd4fbd3e909cce19831c8d86ccbee/data/create_learning2014.R)). The script stores the data to `learning2014.csv`, so let's start by reading that file and printing out the dataset structure, first few rows[^2.1], and some summary statistics.

```{r 'input'}
dset <- read.csv("data/learning2014.csv")
```

```{r summary1}
str(dset)
knitr::kable(head(dset, 5))  # See footnote 
summary(dset)
count(dset, gender)
```

This data contains 166 data points (rows). The original data has 187 rows, however the students with 0 points were omitted during the data wrangling. Out of the 166 remaining students, 110 were female and 56 were male. The students' age ranges from 17 to 55 years, with median at 22 years. 

Next, here is a plot that shows the distributions of the variables and the cross-correlation between each variable within the data. First, most of the distributions are similar to (slightly skewed) Gaussian distributions, however there are exceptions. Notably, `age` is similar to an [inverse-gamma distribution](https://en.wikipedia.org/wiki/Inverse-gamma_distribution): a sharp peak at low values and a long trailing tail. Even when ignoring the high-end "outliers", the distribution is still positively skewed -- as seen in the boxplot. Second, there is no clear difference between males and females for any of the variables. Third, the correlations seem to be rather weak ($|\rho| \lesssim 0.2$), except for `stra` and `surf` ($\rho_{stra,surf} \approx -0.32$) and for `attitude` and `points`($\rho_{attitude,points} \approx 0.44$), for whom the correlation is a bit stronger.
Finally, as the correlation values are not properly displayed in the figure due to the figure size, I've included the Pearson correlation coefficient table below the figure.
```{r 'pairplot'}
ggpairs(dset, 
        mapping = aes(col = gender, alpha = 0.3), 
        lower = list(combo=wrap("facethist", bins=20))
       )
cor(dset[-1])  # Exclude 'gender' column
```

## Fitting the linear model
```{r 'linearmodel'}
# Target: points
# Explanatory variables (3): attitude, stra, surf
#   based on absolute value of correlation coefficient (Pearson)
model <- lm(points ~ attitude + stra + surf, dset)
summary(model)
```
Yeah, not good stats. Drop `surf` as it is not meaningful at all.
```{r 'linearmodel2'}
model <- lm(points ~ attitude, dset)
summary(model)
```
Better.

```{r}
p_att <- ggplot(dset, mapping=aes(attitude, points)) +
           geom_point() +
           geom_smooth(method="lm") + 
           labs(title="title")
        
p_stra <- ggplot(dset, mapping=aes(stra, points)) +
            geom_point() +
            geom_smooth(method="lm") +
            labs(title="title")

grid.arrange(p_att, p_stra, nrow=1, ncol=2)
```

## Interpreting the model and the model diagnostics

```{r 'diagnostics-plots', fig.height=8}
par(mfrow = c(2,2))
plot(model, which=c(1,2,5))

```



[^2.1]: I'm using the `knitr::kable` function here to output prettier tables. It doesn't affect the data values in any way, it is a purely aesthetic helper function.